<!-- Webflow Embed Code for Photo Galleries Template -->
<!-- Replace the existing embed code with this updated version -->

<div id="gallery-wrapper" style="width:100%;min-height:600px">
  <iframe
    id="lot43-gallery"
    style="width:100%;border:none;min-height:800px"
    loading="lazy"
  ></iframe>
</div>

<script>
  // Set iframe source based on URL slug
  var slug = window.location.pathname.split("/").pop();
  document.getElementById("lot43-gallery").src =
    "https://dustchambers.github.io/beltline-app-gallery/gallery.html?id=" + slug;

  // State saved when lightbox opens
  var savedIframeHeight = "";
  var savedScrollY = 0;

  // Listen for iframe messages
  window.addEventListener("message", function(e) {
    var iframe = document.getElementById("lot43-gallery");

    // Handle resize messages - update iframe height to match content
    if (e.data && e.data.type === "resize") {
      iframe.style.height = e.data.height + "px";
    }

    // Handle viewport position request - tell iframe where it's visible
    if (e.data && e.data.type === "get-viewport-position") {
      var rect = iframe.getBoundingClientRect();
      var viewportTop = Math.max(0, -rect.top);
      var viewportHeight = window.innerHeight;

      // Save state before locking
      savedIframeHeight = iframe.style.height;
      savedScrollY = window.scrollY;

      // Expand iframe to cover the full viewport
      iframe.style.height = (viewportTop + viewportHeight) + "px";

      iframe.contentWindow.postMessage({
        type: "viewport-position",
        top: viewportTop,
        height: viewportHeight
      }, "*");

      // Lock scroll using position:fixed (overflow:hidden alone is insufficient)
      document.body.style.position = "fixed";
      document.body.style.top = "-" + savedScrollY + "px";
      document.body.style.left = "0";
      document.body.style.right = "0";
      document.body.style.overflow = "hidden";
    }

    // Handle lightbox close - restore parent page scrolling and iframe size
    if (e.data && e.data.type === "lightbox-close") {
      document.body.style.position = "";
      document.body.style.top = "";
      document.body.style.left = "";
      document.body.style.right = "";
      document.body.style.overflow = "";
      window.scrollTo(0, savedScrollY);
      iframe.style.height = savedIframeHeight;
    }
  });
</script>
